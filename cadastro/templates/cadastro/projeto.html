{% extends 'cadastro/default.html' %}

{% load bootstrap3 %}

{% load static %}

{% load verbose %}
{% load getattr %}
{% load meta %}

{% block css %}

	<link rel="stylesheet" type="text/css" href="{% static 'cadastro/projeto-style.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'templates/bootstrap-file-upload/file-upload.css' %}">

{% endblock %}

{% block js %}
	
	<script type="text/javascript" src="{% static 'cadastro/projeto.js' %}"></script>
	<script src="{% static 'templates/bootstrap-file-upload/file-upload.js' %}"></script>

	<script type="text/javascript">

	    $(document).ready(function() {

	        $('.file-upload').file_upload();

	        $('.file-upload-text').on('DOMSubtreeModified',function(){
	        	$( "#submit-anexo" ).prop( "disabled", false );
			})

	    });
	</script>

{% endblock %}

{% block content %}

	{% with request.resolver_match.url_name as url %}

			<div class="panel with-nav-tabs panel-success">
                <div class="panel-heading">
                    <ul class="nav nav-tabs nav-projeto">
                        <li class="{% if 'projeto-' in url %} active {% endif %}"><a href="#descricao" data-toggle="tab" class="detalhes">Detalhes</a></li>
                        <li class="{% if 'participante-' in url %} active {% endif %} {% if not pk %} disabled {% endif %}"><a href="#adbolsistas" data-toggle="tab">Vincular bolsista</a></li>
                        <li class="{% if not pk %} disabled {% endif %}"><a href="#vatividade" data-toggle="tab">Vincular atividade</a></li>
                        <li class="{% if not pk %} disabled {% endif %}"><a href="#cronograma" data-toggle="tab">Cronograma</a></li>
                        <li class="{% if 'anexo-' in url %} active {% endif %} {% if not pk %} disabled {% endif %}"><a href="#anexos" data-toggle="tab">Anexos</a></li>
                        <li class="{% if not pk %} disabled {% endif %}"><a href="#resumo" data-toggle="tab">Resumo</a></li>
                        
                    </ul>
                </div>

                <div class="panel-body">

                	{% if form.errors %}

                		<div class="alert alert-danger">
						  <strong>Erros no formulário!</strong> Não foi possível salvar a aba Detalhes
						</div>

                	{% endif %}

                	{% if formp.errors %}

                		<div class="alert alert-danger">
						  <strong>Erros no formulário!</strong> Não foi possível salvar a aba Vincular bolsista.

						  {{formp.errors}}
						</div>

                	{% endif %}


                    <div class="tab-content">
                        <div class="tab-pane fade {% if 'projeto-' in url %} in active {% endif %}" id="descricao">

                        	<form class="form" id="form-detalhes" role="form" method="POST" action="{% if pk %} {% url 'projeto-editar' pk %} {% else %}{% url 'projeto-criar' %}{% endif %}">

							{% csrf_token %}

							<fieldset class="well the-fieldset">

			                    <legend class="the-legend">Identificação</legend>

	                        	<div class="form-group row required">
			                        <label for="inputKey" class="col-md-2 control-label">Nome do Projeto:</label>
			                        <div class="col-md-10">
			                            {{ form.nome }}
			                            <div class="help-block">{{ form.nome.errors }}</div>
			                        </div>
			                    </div>

			                    <div class="form-group row required">
			                        <label for="inputKey" class="col-md-2 control-label">Sigla:</label>
			                        <div class="col-md-10">
			                            {{ form.sigla }}
			                            <div class="help-block">{{ form.sigla.errors }}</div>
			                        </div>
			                    </div>
			                </fieldset>

		                    <fieldset class="well the-fieldset">

			                    <legend class="the-legend">Proponente</legend>

			                    <div class="form-group row required  {% if form.entidade_proponente.errors %}{{ 'has-error' }}{% endif %}">
			                        <label for="inputValue" class="col-md-2 control-label">Instituição:</label>
			                        <div class="col-sm-10">
			                            {{ form.entidade_proponente }}
			                            <div class="help-block">{{ form.entidade_proponente.errors }}</div>
			                        </div>
			                    </div>
			                    

			                    <div class="form-group row required {% if form.responsavel_proponente.errors %}{{ 'has-error' }}{% endif %}">
			                        <label for="inputValue" class="col-md-2 control-label">Responsável:</label>
			                        <div class="col-md-10">
			                            {{ form.responsavel_proponente }}
			                            <div class="help-block">{{ form.responsavel_proponente.errors }}</div>
			                        </div>
			                    </div>

			                    <div class="form-group row required {% if form.responsavel_tecnico_proponente.errors %}{{ 'has-error' }}{% endif %}">
			                        <label for="inputValue" class="col-md-2 control-label">Responsável Técnico:</label>
			                        <div class="col-md-10">
			                            {{ form.responsavel_tecnico_proponente }}
			                            <div class="help-block">{{ form.responsavel_tecnico_proponente.errors }}</div>
			                        </div>
			                    </div>

			                </fieldset>

			                <fieldset class="well the-fieldset">

			                    <legend class="the-legend">Concedente</legend>

			                    <div class="form-group row required  {% if form.entidade_concedente.errors %}{{ 'has-error' }}{% endif %}">
			                        <label for="inputValue" class="col-md-2 control-label">Instituição:</label>
			                        <div class="col-sm-10">
			                            {{ form.entidade_concedente}}
			                            <div class="help-block">{{ form.entidade_concedente.errors }}</div>
			                        </div>
			                    </div>
			                    

			                    <div class="form-group row required {% if form.responsavel_concedente.errors %}{{ 'has-error' }}{% endif %}">
			                        <label for="inputValue" class="col-md-2 control-label">Responsável:</label>
			                        <div class="col-md-10">
			                            {{ form.responsavel_concedente }}
			                            <div class="help-block">{{ form.responsavel_concedente.errors }}</div>
			                        </div>
			                    </div>

			                    <div class="form-group row required {% if form.responsavel_tecnico_concedente.errors %}{{ 'has-error' }}{% endif %}">
			                        <label for="inputValue" class="col-md-2 control-label">Responsável Técnico:</label>
			                        <div class="col-md-10">
			                            {{ form.responsavel_tecnico_concedente }}
			                            <div class="help-block">{{ form.responsavel_tecnico_concedente.errors }}</div>
			                        </div>
			                    </div>

			                </fieldset>

			                <fieldset class="well the-fieldset">

			                    <legend class="the-legend">Outros</legend>

				                <div class="form-group row required {% if form.metodologia.errors %}{{ 'has-error' }}{% endif %}">
			                        <label for="inputValue" class="col-md-2 control-label">Metodologia:</label>
			                        <div class="col-md-10">
			                            {{ form.metodologia }}
			                            <div class="help-block">{{ form.metodologia.errors }}</div>
			                        </div>
			                    </div>

			                    <div class="form-group row required {% if form.gestao_transferencia_tecnologia.errors %}{{ 'has-error' }}{% endif %}">
			                        <label for="inputValue" class="col-md-2 control-label">Gestão de Projeto e Transferência de Tecnologia:</label>
			                        <div class="col-md-10">
			                            {{ form.gestao_transferencia_tecnologia }}
			                            <div class="help-block">{{ form.gestao_transferencia_tecnologia.errors }}</div>
			                        </div>
			                    </div>
			                </fieldset>

                        </div>

                        </form>
	              			
                        <div class="tab-pane fade {% if 'participante-' in url %} in active {% endif %}" id="adbolsistas">

                        	<form class="form" method="POST" action="{% if pk and pkparticipante %}{% url 'participante-proj-editar' pk pkparticipante %} {% endif %}{% if pk and not pkparticipante %} {% url 'participante-proj-criar' pk %}{% endif %}">

							{% csrf_token %}

	                    	<fieldset class="well the-fieldset">

	                    		<legend class="the-legend">Bolsista</legend>

	                    		{{ formp.projeto }}

				                <div class="form-group row required {% if formp.bolsista.errors %}{{ 'has-error' }}{% endif %}">
			                        <label for="inputValue" class="col-md-2 control-label">Bolsista:</label>
			                        <div class="col-md-10">
			                            {{ formp.bolsista }}
			                            <div class="help-block">{{ formp.bolsista.errors }}</div>
			                        </div>
			                    </div>


			                    <div class="form-group row ">
				                    <div class="{% if formp.funcao.errors %}{{ "has-error" }}{% endif %}">
				                        <label for="inputKey" class="col-md-2 control-label">Função:</label>
				                        <div class="col-md-7">
				                            {{ formp.funcao }}
				                            <div class="help-block">{{ formp.funcao.errors }}</div>
				                        </div>
				                    </div>

				                    <div class="{% if formp.ic_ativo.errors %}{{ "has-error" }}{% endif %}">
				                        <label for="inputValue" class="col-md-1 control-label">Ativo:</label>
				                        <div class="col-md-1">
				                            {{ formp.ic_ativo }}
				                            <div class="help-block">{{ formp.ic_ativo.errors }}</div>
				                        </div>
				                    </div>
				                </div>

				            </fieldset>

			                <fieldset class="well the-fieldset">
			                    <legend class="the-legend">Especificação da Bolsa</legend>

			                    <div class="form-group row ">
					                <div class="{% if formp.categoria.errors %}{{ 'has-error' }}{% endif %}">
					                    <label for="inputKey" class="col-md-2 control-label">Categoria:</label>
					                    <div class="col-md-4">
					                        {{ formp.categoria }}
					                        <div class="help-block">{{ formp.categoria.errors }}</div>
					                    </div>
					                </div>
					                <div class="{% if formp.periodo_total.errors %}{{ 'has-error' }}{% endif %}">
					                    <label for="inputValue" class="col-md-3 control-label">Período Total Previsto:</label>
					                    <div class="col-md-3">
					                        {{ formp.periodo_total }}
					                        <div class="help-block">{{ formp.periodo_total.errors }}</div>
					                    </div>
					                </div>
					            </div>

					            <div class="form-group row ">
					                <div class="{% if formp.modalidade.errors %}{{ 'has-error' }}{% endif %}">
					                    <label for="inputKey" class="col-md-2 control-label">Modalidade:</label>
					                    <div class="col-md-4">
					                        {{ formp.modalidade }}
					                        <div class="help-block">{{ formp.modalidade.errors }}</div>
					                    </div>
					                </div>
					                <div class="{% if formp.horas_semanais.errors %}{{ 'has-error' }}{% endif %}">
					                    <label for="inputValue" class="col-md-3 control-label">Número de Horas Semanais:</label>
					                    <div class="col-md-3">
					                        {{ formp.horas_semanais }}
					                        <div class="help-block">{{ formp.horas_semanais.errors }}</div>
					                    </div>
					                </div>
					            </div>

					            <div class="form-group row ">
					                <div class="{% if formp.nivel.errors %}{{ 'has-error' }}{% endif %}">
					                    <label for="inputKey" class="col-md-2 control-label">Nível:</label>
					                    <div class="col-md-4">
					                        {{ formp.nivel }}
					                        <div class="help-block">{{ formp.nivel.errors }}</div>
					                    </div>
					                </div>
					                <div class="{% if formp.valor_mensal.errors %}{{ 'has-error' }}{% endif %}">
					                    <label for="inputValue" class="col-md-3 control-label">Valor Mensal:</label>
					                    <div class="col-md-3">
					                        {{ formp.valor_mensal }}
					                        <div class="help-block">{{ formp.valor_mensal.errors }}</div>
					                    </div>
					                </div>
					            </div>


					            <div class="form-group row ">
					                <div class="{% if formp.nivel.errors %}{{ 'has-error' }}{% endif %}">
					                    <label for="inputValue" class="col-md-2 control-label">Vigência Prevista:</label>
				                        <div class="col-md-4">
				                            <fieldset class="well the-fieldset">

				                            	<div class="{% if formp.inicio_vigencia.errors %}{{ 'has-error' }}{% endif %}">
					                                <label for="inputKey" class="col-md-3 control-label">Início:</label>
					                                <div class="col-md-9">
					                                    {{ formp.inicio_vigencia }}
					                                </div>
				                                </div>

				                                <br><br>

				                                <div class="{% if formp.termino_vigencia.errors %}{{ 'has-error' }}{% endif %}">
					                                <label for="inputKey" class="col-md-3 control-label">Término:</label>
					                                <div class="col-md-9">
					                                    {{ formp.termino_vigencia }}
					                                </div>
				                                </div>
				                            </fieldset>
				                        </div>
					                </div>
					                <div class="{% if formp.valor_total.errors %}{{ 'has-error' }}{% endif %}">
					                    <label for="inputValue" class="col-md-3 control-label">Valor Total:</label>
					                    <div class="col-md-3">
					                        {{ formp.valor_total }}
					                        <div class="help-block">{{ formp.valor_total.errors }}</div>
					                    </div>
					                </div>
					            </div>

			                </fieldset>

			                <button type="submit" class="btn btn-info">Vincular Bolsista</button>
			                <a href="{% url 'projeto' %}" class="btn btn-default">Voltar</a>

			             

			                <br><br>
			                </form>

			                    <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">

						            <thead>
						            <tr>
						                {% for item in formp.preview %}
						                    <th>{% verbose formp.instance item %}</th>
						                {% endfor %}
						                <th>Ações</th>
						            </tr>
						            </thead>

						            <tbody>
						            {% for item in datap %}
						                <tr class="odd gradeX">
						                    {% for field in formp.preview %}
						                        {% with item|getattr:field as value %}
						                            <td>
						                                {% if value|is_bool %}
						                                    <input type="checkbox" {% if value %} checked {% endif %} disabled>
						                                {% else %}
						                                    {{ value }}
						                                {% endif %}
						                            </td>
						                        {% endwith %}
						                    {% endfor %}
						                    <td>
						                        <div class="btn-group">
						                            <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown">
						                                Editar
						                                <span class="caret"></span>
						                            </button>
					                                <ul class="dropdown-menu" role="menu">
					                                    <li><a href="{% url 'participante-proj-editar' pk item.pk %}">Modificar</a></li>
					                                    <li><a href="{% url 'participante-remover' pk item.pk %}" onclick="return confirm('Tem certeza? O registro será apagado permanentemente')">Excluir</a></li>

					                                </ul>
						                        </div>
						                    </td>
						                </tr>
						            {% endfor %}
						            </tbody>


							    </table>

                        </div>
                        <div class="tab-pane fade" id="vatividade">

                        	<fieldset class="well the-fieldset">

			                    <legend class="the-legend">Cadastro de Meta</legend>

			                    <div class="form-group row required {% if formm.titulo.errors %}{{ 'has-error' }}{% endif %}">
			                        <label for="inputValue" class="col-md-2 control-label">Título da Meta:</label>
			                        <div class="col-md-10">
			                            {{ formm.titulo }}
			                            <div class="help-block">{{ formm.titulo.errors }}</div>
			                        </div>
			                    </div>

			                    <div class="form-group row required {% if formm.descricao.errors %}{{ 'has-error' }}{% endif %}">
			                        <label for="inputValue" class="col-md-2 control-label">Descrição:</label>
			                        <div class="col-md-10">
			                            {{ formm.descricao }}
			                            <div class="help-block">{{ formm.descricao.errors }}</div>
			                        </div>
			                    </div>

			                    <div class="form-group row required {% if formm.ic_ativo.errors %}{{ 'has-error' }}{% endif %}">
			                        <label for="inputValue" class="col-md-2 control-label">Ativo:</label>
			                        <div class="col-md-1">
			                            {{ formm.ic_ativo }}
			                            <div class="help-block">{{ formm.ic_ativo.errors }}</div>
			                        </div>
			                    </div>

			                </fieldset>

			                <fieldset class="well the-fieldset">

			                    <legend class="the-legend">Atividade Vinculada</legend>


			                </fieldset>

                        </div>
                        <div class="tab-pane fade" id="cronograma">
	                        <fieldset class="well the-fieldset">

			                    <legend class="the-legend">Cadastro de Meta</legend>

			                    <div class="form-group row required">
			                        <label for="inputKey" class="col-md-2 control-label">Título da meta:</label>
			                        <div class="col-md-10">
			                            <input type="text" class="form-control" id="inputKey" placeholder="">
			                        <br>
			                        </div>
			                    </div>

			                    <div class="form-group row required">
			                        <label for="inputKey" class="col-md-2 control-label">Descrição:</label>
			                        <div class="col-md-10">
			                            <textarea type="text" class="form-control" id="inputKey" placeholder=""></textarea>
			                        </div>
			                    </div>

			                    <div class="form-group row">
			                        <label for="inputValue" class="col-md-2 control-label">Ativo:</label>
			                        <div class="col-md-1">
			                            <input type="checkbox" class="form-control" id="inputValue" placeholder="">
			                        </div>
			                    </div>

			                </fieldset>

			                <fieldset class="well the-fieldset">

			                    <legend class="the-legend">Atividade Vinculada</legend>


			                </fieldset>

                        </div>

                        <div class="tab-pane fade {% if 'anexo-' in url %} in active {% endif %}" id="anexos">
                        
			                <fieldset class="well the-fieldset">

					            <legend class="the-legend">Anexos do Projeto</legend>

				            	{% if pk %}

					            <form action="{% url 'anexo-proj-upload' pk %}" method="post" class="form" enctype="multipart/form-data">

			                        {% csrf_token %}

			                        {{ formfp.projeto }}

								    <div class="form-group row ">
					                    <div class="{% if formfp.arquivo.errors %}{{ 'has-error' }}{% endif %}">  
					                        <div class="col-md-4">
					                        	<label class="file-upload btn btn-warning">
									                Procurar ... {{ formfp.arquivo }}
									            </label>
					                            <div class="help-block">{{ formfp.arquivo.errors }}</div>
					                        </div>
					                    </div>

					                    <div class="">
					                        <div class="col-md-1">
					                            {% buttons %}
						                            <button type="submit" class="btn btn-primary" id="submit-anexo" disabled="">
						                            	Salvar anexo
						                            </button>
						                        {% endbuttons %}
					                        </div>
					                    </div>
					                </div>
			                        
			                    </form>

			                    {% endif %}

					            <br><br>

					            <div>
					                <table class="table table-striped file-table">

					                    {% for document in attachments %}
					                        <tr>
					                            <td class="col-sm-2"><a href="{% url 'anexo-proj-remover' document.pk %}" class="delete-file-x" onclick="return confirm('Tem certeza? O arquivo será apagado permanentemente')"><i class="fa fa-times" aria-hidden="true"></i></a></td>
					                            <td class="col-sm-2"><i class="fa fa-file-word-o file-icon" aria-hidden="true"></i></td>
					                            <td class="col-sm-8"><a target="_blank" href="{% url 'show-anexo' document.pk %}" class="open-file">{{ document.filename }}</a></td>
					                            <!--<td><img src="{{ document.arquivo.url }}" alt=""></td>-->
					                        </tr>
					                    {% endfor %}

					                </table>
					            </div>

                        </div>

                        <div class="tab-pane fade" id="resumo">

                        	<fieldset class="well the-fieldset">

			                    <legend class="the-legend">Resumo do Projeto</legend>


			                </fieldset>

                        </div>
                    </div>

		<div id="form-buttons">
			<button class="btn btn-info" id="confirm-button">Salvar</button>
			<a href="{% url 'projeto' %}" class="btn btn-default">Voltar</a>
		</div>
	{% endwith %}
			

{% endblock %}